{"NAME":"CHRONICFU","LASTUPDATE":"20190722163617","SQLSCRIPT":" SELECT  '[#HOSCODE]' HOSPCODE, RIGHT(CONCAT('000000',o2.pcu_person_id),6) PID, o2.seq_id SEQ, DATE_FORMAT(o3.vstdate,'%Y%m%d') DATE_SERV,  FORMAT(IFNULL(o3.bw,0),1) WEIGHT, FORMAT(IFNULL(o3.height,0),0) HEIGHT, IF(o3.waist='' OR o3.waist IS NULL,0,FORMAT(o3.waist,0)) WAIST_CM, IF(o3.bps='' OR o3.bps IS NULL,0,FORMAT(o3.bps,0)) SBP, IF(o3.bpd='' OR o3.bpd IS NULL,0,FORMAT(o3.bpd,0)) DBP, IF(c1.do_foot_screen='Y',IF(c1.has_foot_cormobidity='Y',3,1),IF(c1.do_foot_screen='N',2,9)) FOOT, IF(c1.do_eye_screen='Y' AND ce.dmht_eye_screen_type_id = 2, IF((ce.dmht_eye_screen_result_left_id > 1 or ce.dmht_eye_screen_result_right_id > 1),4,IF((ce.dmht_eye_screen_result_left_id = 1 or ce.dmht_eye_screen_result_right_id = 1),2,9)), IF(c1.do_eye_screen='Y' AND ce.dmht_eye_screen_type_id = 1, IF((ce.dmht_eye_screen_result_left_id > 1 or ce.dmht_eye_screen_result_right_id > 1),3,IF((ce.dmht_eye_screen_result_left_id = 1 or ce.dmht_eye_screen_result_right_id = 1),1,9)), IF(c1.do_eye_screen='Y' AND (ce.dmht_eye_screen_type_id NOT IN (1,2) OR ce.dmht_eye_screen_type_id IS NULL),9,8))) RETINA, IF(o1.doctor,o1.doctor,dr.code) PROVIDER, DATE_FORMAT(o2.update_datetime,'%Y%m%d%H%i%s') D_UPDATE, '[#HOSCODE]' CHRONICFUPLACE,pt.cid CID FROM ovst o1 LEFT JOIN clinicmember_cormobidity_screen c1 ON c1.vn = o1.vn LEFT JOIN clinicmember_cormobidity_eye_screen ce on ce.clinicmember_cormobidity_screen_id = c1.clinicmember_cormobidity_screen_id  LEFT JOIN ovst_seq o2 ON o2.vn = o1.vn LEFT JOIN opdscreen o3 ON o3.vn = o1.vn LEFT JOIN patient pt ON pt.hn = o1.hn LEFT JOIN opduser u on u.loginname = o1.staff LEFT JOIN doctor dr on dr.code = u.doctorcode WHERE  o3.vstdate BETWEEN '[#DATE_START]' and '[#DATE_END]' AND o2.seq_id is not null AND  o1.vn IN (SELECT vn FROM ovstdiag WHERE vn = o1.vn AND (icd10 BETWEEN 'E10' and 'E148' or icd10 BETWEEN 'I10' and 'I159') group by vn) GROUP BY o1.vn ORDER BY DATE_SERV,SEQ"}