{"NAME":"LABFU","LASTUPDATE":"20190718205758","SQLSCRIPT":" SELECT  '[#HOSCODE]' HOSPCODE, RIGHT(CONCAT('000000',ps.person_id),6) PID, s.seq_id SEQ, CAST(lh.order_date AS UNSIGNED) DATE_SERV, li.provis_labcode LABTEST, FORMAT(l.lab_order_result,2) LABRESULT, CAST(s.update_datetime AS UNSIGNED) D_UPDATE, '[#HOSCODE]' LABPLACE, ps.cid CID FROM lab_order l  LEFT JOIN lab_head lh on lh.lab_order_number = l.lab_order_number   LEFT JOIN ovst ov on ov.vn = lh.vn   LEFT JOIN clinicmember c on c.hn = ov.hn   LEFT JOIN ovst_seq s on s.vn = ov.vn  LEFT JOIN lab_items li on li.lab_items_code=l.lab_items_code  LEFT JOIN person ps on ps.patient_hn=ov.hn WHERE c.clinic in (SELECT clinic FROM `clinic` WHERE  (no_export is null OR no_export<>'Y' OR no_export=''))   AND li.provis_labcode is not null and li.provis_labcode not in (0440204,0440203) and l.lab_order_result<>'' and l.lab_order_result is not null  AND lh.order_date between '[#DATE_START]' and '[#DATE_END]' GROUP BY PID,SEQ,DATE_SERV,LABTEST UNION SELECT  '[#HOSCODE]' HOSPCODE, RIGHT(CONCAT('000000',ps.person_id),6) PID, '' SEQ, CAST(lh.order_date AS UNSIGNED) DATE_SERV, li.provis_labcode LABTEST, FORMAT(l.lab_order_result,2) LABRESULT, CONCAT(DATE_FORMAT(lh.report_date,'%Y%m%d'),DATE_FORMAT(lh.report_time,'%H%i%s')) D_UPDATE, '[#HOSCODE]' LABPLACE, ps.cid CID FROM lab_order l  LEFT JOIN lab_head lh on lh.lab_order_number = l.lab_order_number   LEFT JOIN an_stat an on an.an = lh.vn   LEFT JOIN clinicmember c on c.hn = lh.hn   LEFT JOIN person ps on ps.patient_hn=lh.hn LEFT JOIN lab_items li on li.lab_items_code=l.lab_items_code   WHERE c.clinic in (SELECT clinic FROM `clinic` WHERE  (no_export is null OR no_export<>'Y' OR no_export=''))   AND li.provis_labcode is not null and li.provis_labcode not in (0440204,0440203) and l.lab_order_result<>'' and l.lab_order_result is not null and an.an is not null AND lh.order_date between '[#DATE_START]' and '[#DATE_END]' GROUP BY PID,SEQ,DATE_SERV,LABTEST UNION SELECT  '[#HOSCODE]' HOSPCODE, RIGHT(CONCAT('000000',ps.person_id),6) PID, s.seq_id SEQ, CAST(lh.order_date AS UNSIGNED) DATE_SERV, li.provis_labcode LABTEST, IF(l.lab_order_result<30,0,IF(l.lab_order_result between 30 AND 300,1,2)) LABRESULT, CAST(s.update_datetime AS UNSIGNED) D_UPDATE, '[#HOSCODE]' LABPLACE, ps.cid CID FROM lab_order l  LEFT JOIN lab_head lh on lh.lab_order_number = l.lab_order_number   LEFT JOIN ovst ov on ov.vn = lh.vn   LEFT JOIN clinicmember c on c.hn = ov.hn   LEFT JOIN ovst_seq s on s.vn = ov.vn  LEFT JOIN lab_items li on li.lab_items_code=l.lab_items_code  LEFT JOIN person ps on ps.patient_hn=ov.hn WHERE c.clinic in (SELECT clinic FROM `clinic` WHERE  (no_export is null OR no_export<>'Y' OR no_export=''))   AND li.provis_labcode='0440204' and l.lab_order_result<>'' and l.lab_order_result is not null  AND lh.order_date between '[#DATE_START]' and '[#DATE_END]' GROUP BY PID,SEQ,DATE_SERV,LABTEST UNION SELECT  '[#HOSCODE]' HOSPCODE, RIGHT(CONCAT('000000',ps.person_id),6) PID, '' SEQ, CAST(lh.order_date AS UNSIGNED) DATE_SERV, li.provis_labcode LABTEST, IF(l.lab_order_result<30,0,IF(l.lab_order_result between 30 AND 300,1,2)) LABRESULT, CONCAT(DATE_FORMAT(lh.report_date,'%Y%m%d'),DATE_FORMAT(lh.report_time,'%H%i%s')) D_UPDATE, '[#HOSCODE]' LABPLACE, ps.cid CID FROM lab_order l  LEFT JOIN lab_head lh on lh.lab_order_number = l.lab_order_number   LEFT JOIN an_stat an on an.an = lh.vn   LEFT JOIN clinicmember c on c.hn = lh.hn   LEFT JOIN person ps on ps.patient_hn=lh.hn LEFT JOIN lab_items li on li.lab_items_code=l.lab_items_code   WHERE c.clinic in (SELECT clinic FROM `clinic` WHERE  (no_export is null OR no_export<>'Y' OR no_export=''))   AND li.provis_labcode='0440204' and l.lab_order_result<>'' and l.lab_order_result is not null and an.an is not null AND lh.order_date between '[#DATE_START]' and '[#DATE_END]' GROUP BY PID,SEQ,DATE_SERV,LABTEST UNION SELECT  '[#HOSCODE]' HOSPCODE, RIGHT(CONCAT('000000',ps.person_id),6) PID, s.seq_id SEQ, CAST(lh.order_date AS UNSIGNED) DATE_SERV, li.provis_labcode LABTEST, IF(l.lab_order_result like '%neg%',0,IF(l.lab_order_result like '%tra%',1,2)) LABRESULT, CAST(s.update_datetime AS UNSIGNED) D_UPDATE, '[#HOSCODE]' LABPLACE, ps.cid CID FROM lab_order l  LEFT JOIN lab_head lh on lh.lab_order_number = l.lab_order_number   LEFT JOIN ovst ov on ov.vn = lh.vn   LEFT JOIN clinicmember c on c.hn = ov.hn   LEFT JOIN ovst_seq s on s.vn = ov.vn  LEFT JOIN lab_items li on li.lab_items_code=l.lab_items_code  LEFT JOIN person ps on ps.patient_hn=ov.hn WHERE c.clinic in (SELECT clinic FROM `clinic` WHERE  (no_export is null OR no_export<>'Y' OR no_export=''))   AND li.provis_labcode='0440203' and l.lab_order_result<>'' and l.lab_order_result is not null  AND lh.order_date between '[#DATE_START]' and '[#DATE_END]' GROUP BY PID,SEQ,DATE_SERV,LABTEST UNION SELECT  '[#HOSCODE]' HOSPCODE, RIGHT(CONCAT('000000',ps.person_id),6) PID, '' SEQ, CAST(lh.order_date AS UNSIGNED) DATE_SERV, li.provis_labcode LABTEST, IF(l.lab_order_result like '%neg%',0,IF(l.lab_order_result like '%tra%',1,2)) LABRESULT, CONCAT(DATE_FORMAT(lh.report_date,'%Y%m%d'),DATE_FORMAT(lh.report_time,'%H%i%s')) D_UPDATE, '[#HOSCODE]' LABPLACE, ps.cid CID FROM lab_order l  LEFT JOIN lab_head lh on lh.lab_order_number = l.lab_order_number   LEFT JOIN an_stat an on an.an = lh.vn   LEFT JOIN clinicmember c on c.hn = lh.hn   LEFT JOIN person ps on ps.patient_hn=lh.hn LEFT JOIN lab_items li on li.lab_items_code=l.lab_items_code   WHERE c.clinic in (SELECT clinic FROM `clinic` WHERE  (no_export is null OR no_export<>'Y' OR no_export=''))   AND li.provis_labcode='0440203' and l.lab_order_result<>'' and l.lab_order_result is not null and an.an is not null AND lh.order_date between '[#DATE_START]' and '[#DATE_END]' GROUP BY PID,SEQ,DATE_SERV,LABTEST ORDER BY DATE_SERV,PID,LABTEST"}