{"NAME":"PROCEDURE_OPD","LASTUPDATE":"20190718221236","SQLSCRIPT":" SELECT * FROM (SELECT  '[#HOSCODE]' HOSPCODE,  RIGHT(CONCAT('000000',q.pcu_person_id),6) PID, q.seq_id SEQ, CAST(o.vstdate AS UNSIGNED) DATE_SERV,  sp.provis_code CLINIC, IF(e2.icd10tm_operation_code<>'' AND e2.icd10tm_operation_code IS NOT NULL,e2.icd10tm_operation_code,IF(e.icd10tm<>'' AND e.icd10tm IS NOT NULL,e.icd10tm,e.icd9cm)) PROCEDCODE, FORMAT(IFNULL(e.price,0),2) SERVICEPRICE, o.doctor PROVIDER,  CAST(q.update_datetime AS UNSIGNED) D_UPDATE, pt.cid CID FROM doctor_operation r   LEFT JOIN er_oper_code e ON e.er_oper_code=r.er_oper_code   LEFT JOIN er_oper_code_area e2 ON e2.er_oper_code_area_id= r.er_oper_code_area_id   LEFT JOIN ovst o ON o.vn=r.vn   LEFT JOIN spclty sp ON sp.spclty = o.spclty   LEFT JOIN ovst_seq q ON q.vn = o.vn  LEFT JOIN patient pt on pt.hn=o.hn  WHERE e.icd9cm IS NOT NULL AND (e.icd9cm<>'' OR e.icd10tm <>'' OR e2.icd10tm_operation_code<>'')  AND DATE(o.vstdate) BETWEEN '[#DATE_START]' and '[#DATE_END]' UNION  SELECT  '[#HOSCODE]' HOSPCODE,  RIGHT(CONCAT('000000',q.pcu_person_id),6) PID, q.seq_id SEQ, CAST(r.vstdate AS UNSIGNED) DATE_SERV,  sp.provis_code CLINIC, ifnull(da.icd10tm_operation_code,e.icd9cm) PROCEDCODE, FORMAT(IFNULL(r.fee,0),2) SERVICEPRICE, o.doctor PROVIDER, CAST(q.update_datetime AS UNSIGNED) D_UPDATE, pt.cid CID FROM dtmain r   left join dttm e ON e.code=r.tmcode   left join dtmain_area da on da.dtmain_id = r.dtmain_id   left join ovst o ON o.vn=r.vn   left join ovst_seq q ON q.vn = o.vn   left join spclty sp ON sp.spclty = o.spclty LEFT JOIN patient pt on pt.hn=o.hn    WHERE (e.icd9cm<>'' OR e.icd10tm_operation_code <>'')  AND DATE(o.vstdate) BETWEEN '[#DATE_START]' and '[#DATE_END]' UNION SELECT  '[#HOSCODE]' HOSPCODE,  RIGHT(CONCAT('000000',q.pcu_person_id),6) PID, q.seq_id SEQ, CAST(r.vstdate AS UNSIGNED) DATE_SERV,  sp.provis_code CLINIC, ifnull(e.icd10tm_operation_code,e.icd9cm) PROCEDCODE, FORMAT(IFNULL(r.fee,0),2) SERVICEPRICE, o.doctor PROVIDER, CAST(q.update_datetime AS UNSIGNED) D_UPDATE, pt.cid CID FROM dtmain r   left join dttm e ON e.code=r.tmcode   left join ovst o ON o.vn=r.vn   left join ovst_seq q ON q.vn = o.vn   left join spclty sp ON sp.spclty = o.spclty  LEFT JOIN patient pt on pt.hn=o.hn   WHERE (e.icd9cm<>'' OR e.icd10tm_operation_code <>'') AND DATE(o.vstdate) BETWEEN '[#DATE_START]' and '[#DATE_END]' UNION  SELECT  '[#HOSCODE]' HOSPCODE,  RIGHT(CONCAT('000000',q.pcu_person_id),6) PID, q.seq_id SEQ, CAST(o.vstdate AS UNSIGNED) DATE_SERV,  sp.provis_code CLINIC, IF(e.icd10tm IS NULL OR e.icd10tm='',e.icd9cm,e.icd10tm) PROCEDCODE, FORMAT(IFNULL(e.price,0),2) SERVICEPRICE, o.doctor PROVIDER, CAST(q.update_datetime AS UNSIGNED) D_UPDATE, pt.cid CID FROM er_regist_oper r   LEFT JOIN er_oper_code e ON e.er_oper_code=r.er_oper_code   LEFT JOIN ovst o ON o.vn=r.vn   LEFT JOIN spclty sp ON sp.spclty = o.spclty   LEFT JOIN ovst_seq q ON q.vn = o.vn  LEFT JOIN patient pt on pt.hn=o.hn   WHERE ((e.icd9cm IS NOT NULL AND e.icd9cm<>'') OR (e.icd10tm IS NOT NULL AND e.icd10tm<>''))  AND DATE(o.vstdate) BETWEEN '[#DATE_START]' and '[#DATE_END]'  UNION  SELECT  '[#HOSCODE]' HOSPCODE,  RIGHT(CONCAT('000000',q.pcu_person_id),6) PID, q.seq_id SEQ, CAST(o.vstdate AS UNSIGNED) DATE_SERV,  sp.provis_code CLINIC, h3.icd10tm   PROCEDCODE, FORMAT(IFNULL(IFNULL(h2.service_price,h3.price),0),2) SERVICEPRICE, o.doctor PROVIDER, CAST(q.update_datetime AS UNSIGNED) D_UPDATE, pt.cid CID  FROM health_med_service h1   left outer join health_med_service_operation h2 on h2.health_med_service_id = h1.health_med_service_id   left outer join health_med_operation_item h3 on h3.health_med_operation_item_id = h2.health_med_operation_item_id   left outer join health_med_organ g1 on g1.health_med_organ_id = h2.health_med_organ_id    left outer join health_med_operation_type t1 on t1.health_med_operation_type_id = h2.health_med_operation_type_id   left outer join health_med_doctor h5 on h5.health_med_doctor_id = h1.health_med_doctor_id   left outer join ovst o on o.vn = h1.vn   left outer join ovst_seq q on q.vn = o.vn   left outer join spclty sp on sp.spclty = o.spclty  LEFT JOIN patient pt on pt.hn=o.hn   WHERE h3.icd10tm IS NOT NULL AND h3.icd10tm<>''  AND DATE(o.vstdate) BETWEEN '[#DATE_START]' and '[#DATE_END]' UNION  SELECT  '[#HOSCODE]' HOSPCODE,  RIGHT(CONCAT('000000',q.pcu_person_id),6) PID, q.seq_id SEQ, CAST(d.vstdate AS UNSIGNED) DATE_SERV,  sp.provis_code CLINIC, REPLACE(d.icd10,' ','') PROCEDCODE, '0.00' SERVICEPRICE, o.doctor PROVIDER, CAST(q.update_datetime AS UNSIGNED) D_UPDATE, pt.cid CID   from ovstdiag d   left join ovst o on o.vn = d.vn   left join ovst_seq q on q.vn = o.vn   left join spclty sp on sp.spclty = o.spclty   LEFT JOIN patient pt on pt.hn=o.hn   WHERE d.icd10  REGEXP '^[0-9]' AND LENGTH(d.icd10)>=3  AND DATE(o.vstdate) BETWEEN '[#DATE_START]' and '[#DATE_END]')p GROUP BY PID,DATE_SERV,SEQ,PROCEDCODE ORDER BY DATE_SERV,SEQ"}